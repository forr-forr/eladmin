<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EL-Admin 用户注册</title>
    <link rel="stylesheet" href="element-ui/lib/theme-chalk/index.css">
    <script src="js/vue.js"></script>
    <script src="element-ui/lib/index.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: "Microsoft YaHei", sans-serif;
            background-color: #f5f6fa;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .page-container {
            display: flex;
            width: 900px;
            height: 560px;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.1);
        }

        /* 左侧背景图 */
        .left-banner {
            width: 55%;
            background-image: url('/static/js/img/login.jpg');
            background-size: cover;
            background-position: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            position: relative;
        }

        .left-banner::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.45);
        }

        .banner-content {
            position: relative;
            text-align: center;
            z-index: 2;
        }

        .banner-title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }

        .banner-subtitle {
            font-size: 14px;
            opacity: 0.9;
        }

        /* 右侧注册框 */
        .register-container {
            width: 45%;
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .register-title {
            font-size: 22px;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
            font-weight: 600;
        }

        .login-link {
            margin-top: 15px;
            font-size: 14px;
            color: #409EFF;
            text-align: center;
            cursor: pointer;
        }

        .login-link:hover {
            text-decoration: underline;
        }

        .el-button {
            width: 100%;
        }
    </style>
</head>
<body>
<div id="app">
    <div class="page-container">
        <!-- 左侧背景 -->
        <div class="left-banner">
            <div class="banner-content">
                <div class="banner-title">EL-Admin</div>
                <div class="banner-subtitle">最简洁的后台管理系统注册界面</div>
            </div>
        </div>

        <!-- 右侧注册表单 -->
        <div class="register-container">
            <h2 class="register-title">用户注册</h2>

            <el-form
                    :model="registerForm"
                    :rules="rules"
                    ref="registerForm"
                    label-width="80px"
            >
                <el-form-item label="用户名" prop="username">
                    <el-input v-model="registerForm.username" placeholder="请输入用户名"></el-input>
                </el-form-item>

                <el-form-item label="邮箱" prop="email">
                    <el-input v-model="registerForm.email" placeholder="请输入邮箱"></el-input>
                </el-form-item>

                <el-form-item label="密码" prop="password">
                    <el-input type="password" v-model="registerForm.password" placeholder="请输入密码" show-password></el-input>
                </el-form-item>

                <el-form-item label="确认密码" prop="confirmPassword">
                    <el-input type="password" v-model="registerForm.confirmPassword" placeholder="请确认密码" show-password></el-input>
                </el-form-item>

                <el-form-item>
                    <el-button type="primary" @click="handleRegister" :loading="loading">注 册</el-button>
                </el-form-item>
            </el-form>

            <div class="login-link" @click="redirectToLogin">已有账号？点击登录</div>
        </div>
    </div>
</div>

<!-- 烟花特效 -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>

<script>
    new Vue({
        el: "#app",
        data() {
            return {
                registerForm: {
                    username: "",
                    email: "",
                    password: "",
                    confirmPassword: ""
                },
                rules: {
                    username: [
                        { required: true, message: "请输入用户名", trigger: "blur" },
                        { pattern: /^[A-Za-z]+$/, message: "用户名只能包含字母", trigger: "blur" },
                        { min: 3, max: 20, message: "用户名长度应在3到20个字符之间", trigger: "blur" }
                    ],
                    email: [
                        { required: true, message: "请输入邮箱", trigger: "blur" },
                        { type: "email", message: "邮箱格式不正确", trigger: "blur" }
                    ],
                    password: [
                        { required: true, message: "请输入密码", trigger: "blur" },
                        { min: 6, max: 20, message: "密码长度应在6到20个字符之间", trigger: "blur" }
                    ],
                    confirmPassword: [
                        { required: true, message: "请确认密码", trigger: "blur" },
                        {
                            validator: (rule, value, callback) => {
                                if (value !== this.registerForm.password) {
                                    callback(new Error("两次输入的密码不一致"));
                                } else {
                                    callback();
                                }
                            },
                            trigger: "blur"
                        }
                    ]
                },
                loading: false
            };
        },
        methods: {
            handleRegister() {
                const { username, email, password, confirmPassword } = this.registerForm;

                if (!username || !email || !password || !confirmPassword) {
                    this.$message.error("请填写所有字段");
                    return;
                }

                if (!/^[A-Za-z]+$/.test(username)) {
                    this.$message.error("用户名只能包含字母");
                    return;
                }

                if (username.length < 3 || username.length > 20) {
                    this.$message.error("用户名长度应在3到20个字符之间");
                    return;
                }

                const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;
                if (!emailRegex.test(email)) {
                    this.$message.error("邮箱格式不正确");
                    return;
                }

                if (password.length < 6 || password.length > 20) {
                    this.$message.error("密码长度应在6到20个字符之间");
                    return;
                }

                if (password !== confirmPassword) {
                    this.$message.error("密码和确认密码不匹配");
                    return;
                }

                this.loading = true;
                fetch("/user/doRegister", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(this.registerForm)
                })
                    .then(res => res.json())
                    .then(data => {
                        this.loading = false;
                        if (data.code === 200) {
                            this.$message.success("注册成功！即将跳转");
                            this.triggerConfetti();
                            setTimeout(() => {
                                window.location.href = "login.html";
                            }, 2000);
                        } else {
                            this.$message.error(data.msg || "注册失败");
                        }
                    })
                    .catch(() => {
                        this.loading = false;
                        this.$message.error("服务器错误，请稍后再试");
                    });
            },
            redirectToLogin() {
                window.location.href = "login.html";
            },
            triggerConfetti() {
                const duration = 3 * 1000;
                const end = Date.now() + duration;

                const frame = () => {
                    confetti({
                        particleCount: 5,
                        spread: 120,
                        startVelocity: 30,
                        origin: { x: Math.random(), y: Math.random() - 0.2 }
                    });
                    if (Date.now() < end) requestAnimationFrame(frame);
                };
                frame();
            }
        }
    });
</script>
</body>
</html>
